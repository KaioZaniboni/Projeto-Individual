<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto IoT - Tempo Real</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- script do google charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="funcoes.js"></script>
</head>

<body>
    <!--header inicio-->

    <div class="corpo_menu">
        <div class="container">
            <img class="imagens_menu" src="Imagens/tradamus.png">
            <div class="separacao">
                <a href="dashboard.html"><img class="imagens_menu" src="Imagens/home.png"></a>
                <a href="publicacoes.html"><img class="imagens_menu" src="Imagens/forum.png"></a>
                <a href="https://nostreidamos.atlassian.net/servicedesk/customer/portal/1"><img class="imagens_menu"
                        src="Imagens/suporte-tecnico.png"></a>
                <a href="#" onclick="logoff()"><img class="imagens_menu" src="Imagens/sair.png"></a>
            </div>
        </div>
    </div>
    </div>
    <!--header fim-->
    <div class="corpo_conteudo">

        <div class="corpo_cabecalho">

            <div class="usuario">
                <img id="perfil" class="imagens_menu imagem_perfil" src="Imagens/sem foto.png">
                <div>Ol√°, <b id="b_usuario"></b></div>
            </div>

            <div class="conteudo_1">
                <div class="display2_ativo">
                    <div class="display2_linha_1">
                        <div>Indice:</div>
                    </div>
                    <div id="indice" class="display2_linha_2"></div>
                </div>
                <div class="display2_ativo">
                    <div class="display2_linha_1">
                        <div>Alta:</div>
                        <div id="alta_percent" class="porcentagem2_ativo_2"></div>
                    </div>
                    <div id="alta" class="display2_linha_2"></div>
                </div>
                <div class="display2_ativo">
                    <div class="display2_linha_1">
                        <div>Baixa :</div>
                        <div id="baixa_percent" class="porcentagem2_ativo_3"></div>
                    </div>
                    <div id="baixa" class="display2_linha_2"></div>
                </div>
                <div class="display2_ativo">
                    <div class="display2_linha_1">
                        <div>Sentido:</div>
                    </div>
                    <div id="sentido" class="display2_linha_2"></div>
                </div>
            </div>

            <form id="form_ativos" method="post" onsubmit="return envia_ativos()">
                <div class="conteudo_2">
                    <div class="conteudo_2_3" id="quadro_1">
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>BANK6</div>
                                <div id="percent_bank6" class="porcentagem_ativo_1">0.00%</div>
                            </div>
                            <div id="preco_bank6" class="display_linha_2">R$ 26,05</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_bank6"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>BBSA3</div>
                                <div id="percent_bbas3" class="porcentagem_ativo_2">0.00%</div>
                            </div>
                            <div id="preco_bbas3" class="display_linha_2">R$ 27,14</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_bbas3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>VALE5</div>
                                <div id="percent_vale5" class="porcentagem_ativo_3">0.00%</div>
                            </div>
                            <div id="preco_vale5" class="display_linha_2">R$ 13,15</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_vale5"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>PETR4</div>
                                <div id="percent_petr4" class="porcentagem_ativo_4">0.00%</div>
                            </div>
                            <div id="preco_petr4" class="display_linha_2">R$ 23,86</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_petr4"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>ZANI3</div>
                                <div id="percent_zani3" class="porcentagem_ativo_5">0.00%</div>
                            </div>
                            <div id="preco_zani3" class="display_linha_2">R$ 36,36</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_zani3"></div>
                            </div>
                        </div>
                    </div>

                    <div class="conteudo_2_4" id="quadro_2">
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>PETZ3</div>
                                <div id="percent_petz3" class="porcentagem_ativo_1">0.00%</div>
                            </div>
                            <div id="preco_petz3" class="display_linha_2">R$ 23,49</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_petz3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>NINJ3</div>
                                <div id="percent_ninj3" class="porcentagem_ativo_2">0.00%</div>
                            </div>
                            <div id="preco_ninj3" class="display_linha_2">R$ 19,75</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_ninj3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>ABEV3</div>
                                <div id="percent_abev3" class="porcentagem_ativo_3">0.00%</div>
                            </div>
                            <div id="preco_abev3" class="display_linha_2">R$ 18,67</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_abev3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>LAME4</div>
                                <div id="percent_lame4" class="porcentagem_ativo_4">0.00%</div>
                            </div>
                            <div id="preco_lame4" class="display_linha_2">R$ 21,50</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_lame4"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>BBDC4</div>
                                <div id="percent_bbdc4" class="porcentagem_ativo_5">0.00%</div>
                            </div>
                            <div id="preco_bbdc4" class="display_linha_2">R$ 26,88</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_bbdc4"></div>
                            </div>
                        </div>
                    </div>

                    <div class="conteudo_2_5" id="quadro_3">
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>VVAR3</div>
                                <div id="percent_vvar3" class="porcentagem_ativo_1">0.00%</div>
                            </div>
                            <div id="preco_vvar3" class="display_linha_2">R$ 13,68</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_vvar3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>SUZB3</div>
                                <div id="percent_suzb3" class="porcentagem_ativo_2">0.00%</div>
                            </div>
                            <div id="preco_suzb3" class="display_linha_2">R$ 59,24</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_suzb3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>ITUB4</div>
                                <div id="percent_itub4" class="porcentagem_ativo_3">0.00%</div>
                            </div>
                            <div id="preco_itub4" class="display_linha_2">R$ 30,39</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_itub4"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>BTOW3</div>
                                <div id="percent_btow3" class="porcentagem_ativo_4">0.00%</div>
                            </div>
                            <div id="preco_btow3" class="display_linha_2">R$ 64,15</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_btow3"></div>
                            </div>
                        </div>
                        <div class="display_ativo">
                            <div class="display_linha_1">
                                <div>LWSA3</div>
                                <div id="percent_lwsa3" class="porcentagem_ativo_5">0.00%</div>
                            </div>
                            <div id="preco_lwsa3" class="display_linha_2">R$ 24,75</div>
                            <div class="display_linha_3">
                                <div>Volume 24h</div>
                                <div id="volume_lwsa3"></div>
                            </div>
                        </div>
                    </div>


                    <div style="display: none;">
                        <input id="volume_acumulado" type="text" name="volume_1_minuto">
                        <input id="indices_pontos" type="text" name="pontuacao">
                        <input id="variacao_indice" type="text" name="variacao_percentual">
                        <input id="volume_monetario" type="text" name="monetario_1_minuto">
                    </div>

                </div>
            </form>

            <div class="conteudo_3">
                <div class="titulo_recomendacao">Artigos Recomendados</div>

                <div id="conjunto_1" class="caixa_recomendacoes_1">
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/sugestao.png">

                        <div class="texto_artigo">
                            Saiba como identificar os padr√µes corretamente,
                            n√£o caia mais em armadilhas com forma√ß√µes de figuras incorretas!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="artigo1.html">Saiba mais &rarr;</a></div>
                        </div>

                    </div>
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo6.png">
                        <div class="texto_artigo">
                            Com a queda da Selic, muitas pessoas buscam novas op√ß√µes de investimento.
                            Entenda como come√ßar a investir em A√ß√µes respeitando seu perfil e seus objetivos!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo5.png">
                        <div class="texto_artigo">
                            Com a queda da Selic, muitas pessoas buscam novas op√ß√µes de investimento.
                            Entenda como come√ßar a investir em A√ß√µes respeitando seu perfil e seus objetivos!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                </div>

                <div id="conjunto_2" class="caixa_recomendacoes_2">
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo2.png">
                        <div class="texto_artigo">
                            O mundo dos minicontratos √© uma grande porta de entrada para o day trade.
                            Confira a seguir o guia definitivo sobre esses ativos!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="artigo1.html">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo3.png">
                        <div class="texto_artigo">
                            Com a queda da Selic, muitas pessoas buscam novas op√ß√µes de investimento.
                            Entenda como come√ßar a investir em A√ß√µes respeitando seu perfil e seus objetivos!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="artigo1.html">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo9.png">
                        <div class="texto_artigo">
                            √â fato que o mercado se move em tend√™ncias definidas nos mais variados Timeframes.
                            Por isso, hoje vou falar das 4 formas que eu uso para identificar tend√™ncias no gr√°fico,
                            baseado nos Princ√≠pios da Teoria de Dow, no meu dia a dia.
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                </div>

                <div id="conjunto_3" class="caixa_recomendacoes_3">
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo8.png">
                        <div class="texto_artigo">
                            Tape Reading e An√°lise Gr√°fica s√£o dois m√©todos muito usados para o trading de curto
                            prazo.
                            Como saber qual a melhor t√©cnica? Leia esse artigo para saber o que s√£o e o que voc√™
                            deve considerar ao usar a leitura de fluxo ou a leitura gr√°fica!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/2-1-1024x870.png">
                        <div class="texto_artigo">
                            Conhe√ßa como funciona o nosso forum e seja um membro ativo na comunidade,
                            o conhecimento s√≥ √© util quando esta em movimento. Ent√£o passe ele adiante...
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                    <div class="recomendacoes">
                        <img class="imagens_artigos" src="Imagens/artigo4.png">
                        <div class="texto_artigo">
                            Com a queda da Selic, muitas pessoas buscam novas op√ß√µes de investimento.
                            Entenda como come√ßar a investir em A√ß√µes respeitando seu perfil e seus objetivos!
                        </div>
                        <div class="saiba_mais">
                            <div class="ajuste_saiba_mais"><a href="">Saiba mais &rarr;</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


<script>
    function quadro_artigos() {
        if (conjunto_1.style.display == 'flex') {
            conjunto_1.style.display = 'none';
            conjunto_2.style.display = 'flex';
            conjunto_3.style.display = 'none';
        } else if (conjunto_2.style.display == 'flex') {
            conjunto_1.style.display = 'none';
            conjunto_2.style.display = 'none';
            conjunto_3.style.display = 'flex';
        } else {
            conjunto_1.style.display = 'flex';
            conjunto_2.style.display = 'none';
            conjunto_3.style.display = 'none';
        }
    }
    setInterval(quadro_artigos, 30000);

    verificar_autenticacao()

    var vetor_ativos_precos = [Number(26.05), Number(27.14), Number(13.15), Number(23.86), Number(36.36),
        Number(23.49), Number(19.75), Number(18.67), Number(21.50), Number(26.88), Number(13.68), Number(
            59.24),
        Number(30.39), Number(24.75), Number(64.15)
    ];
    var vetor_preco_antigo = [Number(26.05), Number(27.14), Number(13.15), Number(23.86), Number(36.36),
        Number(23.49), Number(19.75), Number(18.67), Number(21.50), Number(26.88), Number(13.68), Number(
            59.24),
        Number(30.39), Number(24.75), Number(64.15)
    ];
    var div_preco_display = [preco_bank6, preco_bbas3, preco_vale5, preco_petr4, preco_zani3, preco_petz3,
        preco_ninj3, preco_abev3, preco_lame4, preco_bbdc4, preco_vvar3, preco_suzb3, preco_itub4,
        preco_btow3,
        preco_lwsa3
    ];
    var div_percent_display = [percent_bank6, percent_bbas3, percent_vale5, percent_petr4, percent_zani3,
        percent_petz3, percent_ninj3, percent_abev3, percent_lame4, percent_bbdc4, percent_vvar3,
        percent_suzb3, percent_itub4, percent_btow3, percent_lwsa3
    ];
    var vetor_ativos_volumes = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    var vetor_div_volumes = [volume_bank6, volume_bbas3, volume_vale5, volume_petr4, volume_zani3,
        volume_petz3, volume_ninj3, volume_abev3, volume_lame4, volume_bbdc4, volume_vvar3,
        volume_suzb3, volume_itub4, volume_btow3, volume_lwsa3
    ];

    var volume = 0;
    var pontos = 0;
    var variacao = 0;
    var monetario = 0;
    var variacao_indice_percentual = 0;

    function variacao_preco() {

        var direcao_negativa = 0;
        var direcao_positiva = 0;

        for (var ativo = 1; ativo <= vetor_preco_antigo.length; ativo++) {

            var sorteio_sobe_desce = parseInt(Math.random() * 2);
            var sorteio = parseInt(Math.random() * 100);
            var adicionar_volume = parseInt(Math.random() * 10);
            var diferenca = 0;
            diferenca += (Number(sorteio / 100000));
            var acumular_volume = 0;
            var acumular_valor = 0;
            var saldo_baixa = 0;
            var saldo_alta = 0;

            diferenca = sorteio_sobe_desce < 1 ?
                vetor_ativos_precos[ativo - 1] += (vetor_ativos_precos[ativo - 1] * diferenca) :
                vetor_ativos_precos[ativo - 1] -= (vetor_ativos_precos[ativo - 1] * diferenca);

            div_percent_display[ativo - 1].innerHTML =
                `${(((diferenca - vetor_preco_antigo[ativo - 1]) / diferenca) *100).toFixed(2)}%`;
            div_preco_display[ativo - 1].innerHTML = `R$ ${vetor_ativos_precos[ativo - 1].toFixed(2)}`;

            vetor_ativos_volumes[ativo - 1] += Number(adicionar_volume);
            vetor_div_volumes[ativo - 1].innerHTML = vetor_ativos_volumes[ativo - 1];

            if (vetor_ativos_precos[ativo - 1] < vetor_preco_antigo[ativo - 1]) {
                div_percent_display[ativo - 1].style.color = "red";
                direcao_negativa++
                saldo_baixa += (vetor_ativos_precos[ativo - 1] * adicionar_volume);
            } else {
                div_percent_display[ativo - 1].style.color = "green";
                direcao_positiva++
                saldo_alta += (vetor_ativos_precos[ativo - 1] * adicionar_volume);
            }

            volume += adicionar_volume;
            volume_acumulado.value = volume;

            monetario += Number(vetor_ativos_precos[ativo - 1] * adicionar_volume);
            volume_monetario.value = monetario;

            acumular_volume += adicionar_volume;
            acumular_valor += vetor_ativos_precos[ativo - 1];
        }
        pontos = (50000 + (saldo_alta - saldo_baixa));
        indices_pontos.value = pontos;
        indice.innerHTML = pontos.toFixed(2);

        variacao_indice_percentual =  (((pontos - 50000) / pontos) *100);
        variacao_indice.value = variacao_indice_percentual;


        baixa.innerHTML = `${direcao_negativa} ativos`;
        alta.innerHTML = `${direcao_positiva} ativos`;
        baixa_percent.innerHTML = `${((direcao_negativa / 15) *100).toFixed(2)}%`;
        alta_percent.innerHTML = `${((direcao_positiva / 15) *100).toFixed(2)}%`;

        if(direcao_positiva > direcao_negativa) {
            sentido.innerHTML = `Em alta`;
        }
        else{
            sentido.innerHTML = `Em baixa`;
        }
    }
    setInterval(variacao_preco, 2000);


    function envia_ativos() {
        var formulario = new URLSearchParams(new FormData(form_ativos));
        fetch("/indice/historico", {
            method: "POST",
            body: formulario
        }).then(function (response) {
            console.log(response);

            if (response.ok) {
                // alert('Volume Cadastrado!');
                volume = 0;
                monetario = 0;

            } else {

                console.log('Erro de cadastro!');
                response.text().then(function (resposta) {
                    alert('Erro ;-;');
                    console.log(resposta)
                });
            }
        });
        return false;
    }
    setInterval(envia_ativos, 60000);
</script>